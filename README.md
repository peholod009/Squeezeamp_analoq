Техническое Задание (ТЗ) на модификацию платы SqueezeAMP

1. Общая информация
1.1. Название проекта
Модифицированная плата SqueezeAMP с поддержкой Ethernet (на базе W5500) + удаление подсистемы питания от батареи и ИК-приемник.

1.2. Цель проекта
На основе существующей платы SqueezeAMP (https://github.com/philippe44/SqueezeAMP) создать модифицированную версию, в которой:
- Удалены все компоненты, связанные с питанием от батареи (зарядка, переключение, мониторинг).
- Удален ИК-приемкни и связанная с ним обвязка
- Добавлена поддержка Ethernet на базе чипа W5500 для проводного сетевого подключения (в дополнение к существующему WiFi/BT на ESP32).
- Сохранены основные функции аудио-подсистемы (усилитель, выходы, расширяемые I/O и т.д.).

1.3. Исходная основа
- Плата SqueezeAMP (версия 3.2 basic).
- Ключевые компоненты исходной платы:
  - ESP32 WROVER (WiFi/BT, встроенная антенна).
  - Усилитель TI TAS575x (стерео, класс D, до 2x20W).
  - Выходы: прямой на динамики, 3.5 мм джек (линейный выход с детекцией вставки), оптический SPDIF.
  - Разъемы: для расширения I/O (SPI, I2C, I2S, GPIO), on/off, сенсоров, питания.
  - LED-индикаторы (зеленый, красный, зарядный — последний будет удален).
  - Питание: разъем 2.5 мм для 5-16V (до 20V в определенных условиях).

Исходная плата имеет модификации "basic" и "boost". За основу рекомендуется использовать вариант "basic".

1.4. Основные изменения
- Удаление подсистемы батареи: Полное исключение зарядки, переключения и мониторинга батареи.
- Удаление ИК-управления и связанной с ним обвязки.
- Добавление Ethernet: Интеграция чипа W5500 для проводного Ethernet (10/100 Mbps), подключенного по SPI к ESP32.
- Размеры платы: Допустимо увеличение (например, добавление пространства для RJ45 и W5500, ориентировочно +20-30 мм по длине/ширине). 
- Рекомендации расположения ethernet-разъема: рядом с входом power in, либо рядом с выходом spdif
- Сохранение совместимости: Все остальные функции (аудио, I/O, питание) должны работать как в оригинале. 

2. Требования к функциональности
2.1. Сохраненные функции
- WiFi/BT подключение на базе ESP32 WROVER.
- Стерео усилитель TI TAS575x (до 2x20W, с учетом теплоотвода).
- Выходы:
  - Прямой на динамики (разъем J5).
  - 3.5 мм джек (J2, с детекцией вставки на IO34).
  - Оптический SPDIF (на IO15).
- Расширяемые разъемы:
  - J3: 6-pin (3.3V, GND, TX/RX, EN/reset, Boot).
  - J6: 8-pin для I/O (SPI, I2C, I2S, GPIO; пин 6 selectable между GND и IO0 via S2).
  - J7: on/off (GND и EN для выключения 3.3V).
  - J8: 2-pin для сенсоров (IO39, IO36; inputs only, без pull-up).
  - J10: 2-pin для 3.3V/GND.
- LED: Зеленый (IO12, active low), красный (IO13, active low). Удалить LED для зарядки.
- Управление усилителем: Mute (IO14), Fault (IO2), I2C (IO26/27), I2S (IO25/32/33).
- Поддержка внешних устройств: Дисплеи (SH1106, SSD1306 и т.д.), кнопки, энкодеры через J6/J3.
- Питание: Только от внешнего источника через J1 (5-16V, рекомендуется 12V для оптимального баланса тепла/мощности усилителя). Защита от обратной полярности на основном питании сохраняется.

2.2. Удаленные функции
- Подсистема батареи:
  - Зарядное устройство (LT3652, индуктор, резисторы R7-R11, зенер D5 и т.д.).
  - Разъемы батареи (J4/J9).
  - Автоматическое переключение между батареей и основным питанием (TPS22810, Schottky-диод).
  - Мониторинг уровня батареи (A/D).
  - Under-voltage detection и power OR.
  - Би-color LED для зарядки.
- ИК-приемник
- Рекомендация: сохранить диод шотки для защиты питания.

2.3. Добавленные функции
- Ethernet на базе W5500:
  - Чип W5500 (Ethernet контроллер с аппаратным TCP/IP стеком, SPI-интерфейс).
  - Разъем RJ45 (с магнитными трансформаторами для изоляции, если требуется; стандартный 8P8C).
  - Поддержка 10/100 Mbps, авто-MDIX.
  - Интеграция: Подключить к доступным GPIO ESP32 через SPI (использовать свободные пины из J6 или новые).
  - Необходимые компоненты: Кристалл 25 MHz для W5500, резисторы/конденсаторы по datasheet (например, для питания, reset, interrupt).
- Питание для Ethernet: 3.3V от основной шины (J10 или J6), потребление ~100-200 mA.
