#ТЕХНИЧЕСКОЕ ЗАДАНИЕ на разработку аудио-энпойнта "SqueezeESP32"

Референсная плата - SqueezeAMP (https://github.com/philippe44/SqueezeAMP)

1. Назначение:  Разработать плату сетевого аудио-плеера на базе ESP32-WROVER. Устройство предназначено для приема аудиопотоков по сети Ethernet и их вывода через цифровые интерфейсы (I2S, оптический S/PDIF). Прошивка - Squeezelite-ESP32. Аппаратная основа - модифицированная схема проекта SqueezeAMP с удалением аналогового тракта и элементов питания батареи.

2. Основные технические характеристики:
- Сетевой интерфейс: Ethernet 10/100 Mbps (IEEE 802.3)
- Цифровой аудиовыход:
  - I2S (Master mode)
  - S/PDIF оптический (TOSLINK)
- Входное напряжение: 5V..48V DC через баррель-джек (Центр - плюс)
- Потребляемая мощность: ~2.5W (макс.)

3. Аппаратная архитектура:

3.1. Центральный процессор:
  - Модуль: ESP32-WROVER (U6). Пайка на плату.
  - Тактирование: Внутренний генератор ESP32.

3.2. Сетевой контроллер (схема и используемые элементы требуют проверки и уточнения):
- Чип: WIZnet W5500 (Требует добавления).
- Обвязка W5500:
  - Кварц 25MHz.
  - Развязывающие конденсаторы 100нФ на выводах питания.
  - Резисторы на линиях SPI (33-100 Ом).
- Разъем: RJ-45 MagJack со встроенными трансформаторами и светодиодами (LINK/ACT). Пример: HR911105A.

3.3. Система питания (Прямое копирование с референса):
- Вход: Разъем Barrel Jack DC-052 (PJ-047B, J1).
- Защита от переполюсовки:
  - Диод Шоттки MBRS340T3G (D6).
  - Диодный контроллер LM74700-Q1 (U4) с внешними MOSFET.
- DC-DC преобразователь: TPS54202 (U1). Конвертирует 5-48V -> 5V.
  - Дроссель: 4.7uH (L1, L2, L3, L4).
  - Обвязка: Резисторы делителя (R8, R9, R10, R11, R12) и конденсаторы (C1, C10, C29, C41, C44) - номиналы строго по схеме референса.
- LDO стабилизатор: XD1117B33M для 5V -> 3.3V.
- Фильтрация: Множество керамических (100нФ, 220нФ, 680нФ) и танталовых/электролитических (1uF, 2u2F, 22uF) конденсаторов, как в BOM.

3.4. Цифровой аудиотракт:

3.4.1. Выход I2S:
- Разъем: JST XH на 7 пинов (шаг 2.54мм).
- Распиновка:
  1. +5V
  2. GND
  3. DATA (DOUT)
  4. LRCK (FS)
  5. BCLK (SCK)
  6. MCLK
  7. GND

3.4.2. Выход S/PDIF (Оптический):
- Трансмиттер: Оптический модуль TOSLINK PLT133/10W (U5).
- Схема формирования сигнала: Прямое копирование с референса.
  - GPIO ESP32 -> Резистор 33 Ом -> Транзистор MMBT3904 (Q2) -> Модуль U5.

3.5. Разъемы интерфейсов и питания:
- I2C: JST XH на 4 пина.
  - Распиновка: 1 - SDA, 2 - SCL, 3 - +3.3V, 4 - GND.
- Питание:
  - +5V: JST XH на 2 пина (с выхода U1)
  - +3.3V: JST XH на 2 пина (с выхода XD1117B33M)
  - GND: JST XH на 4 пина
- UART: 4-пиновая гребенка (шаг 2.54мм). Выводы: TX, RX, GND, EN.

3.6. Индикация и управление:
- Светодиод "POWER" (Синий): Подключен к линии +3.3V через резистор ~1кОм (D1).
- Светодиод "STATUS/ERROR" (Красный): Управляется GPIO ESP32 через резистор ~220 Ом (D8).
- Кнопка "BOOT": CJS-1200TA (S2) между GPIO0 и GND.
- Кнопка "RESET": EVPBB (S1) между EN и GND.

4. Компоненты, подлежащие удалению:
- Аналоговый тракт (U2-TAS5780M и обвязка: C13-C16, C18, C19, C22-C24, R5, R6, J2, J3, J6)
- Заряд батареи (U3-LT3652EMSE и обвязка: C3, C5, C6, C17, C31, D3, D4, D5, D7, D9, L5, L7, Q1, R3, R7, J4, J9)
- Сервисные разъемы (J7, J8, J10)

5. Компоненты, подлежащие добавлению:
- W5500 с обвязкой (кварц 25MHz, конденсаторы, резисторы)
- RJ-45 MagJack
- Разъемы JST XH
- Резисторы в цепи S/PDIF

6. Конструктивные требования:
- Плата: Двусторонняя, FR-4
- Размещение: Все разъемы на краях платы
- Разводка: Короткие согласованные линии SPI и I2S, сплошной полигон GND

7. Выходные данные:
- Полный пакет Gerber (X2), Drill, BOM и Centroid файлы

---

Заключение: За основу берется схема и разводка SqueezeAMP. Удаляется аналоговый тракт и схема заряда, добавляется Ethernet на W5500. Все разъемы питания и интерфейсов выполняются типа JST XH, UART выводится на гребенку 2.54мм.

++ Все необходимые материалы приложены.

---
Желаемая схема. Расположение элементов на схеме - приблизительное. Возможна корректировка исходя из особенностей допустимой разводки элементов на плате.

Описание разъемов референсной платы, которые остаются в новой версии (оригинальная плата SqueezeAMP):

J3: main header
- GND
- 3.3V output
- TX (35) IO1
- RX (34) IO3
- EN/reset (3) ==> connect to RTS if possible
- Boot (25) IO0 ==> pull down at reset to enter download mode (connect to DTR if possible). It's also connected to the IR

J6: IO extension connector (note that a right-angle and a straight version exist)
- (26) IO4
- (29) IO5
- (30) IO18
- (31) IO19
- (33) IO21
- (35) IO0/GND depending on S2
- (36) IO22
- (37) IO23

J7: on/off (on when floating/open)
- GND
- ENable ==> short with pin 1/GND to switch off 3.3V power

J8: Input/Sensor connector (inputs only, no internal pull-up)
- (5) IO39
- (4) IO36

S2: select J6 pin 6 between GND and IO0

Верхняя часть платы:

<img width="600" height="387" alt="TOP" src="https://github.com/user-attachments/assets/39c3300a-0d19-42f3-b561-77f5af521304" />

Нижняя часть платы:

<img width="600" height="387" alt="BOTTOM" src="https://github.com/user-attachments/assets/8ada5987-19d2-4c6e-ab8d-8222a224ad99" />

